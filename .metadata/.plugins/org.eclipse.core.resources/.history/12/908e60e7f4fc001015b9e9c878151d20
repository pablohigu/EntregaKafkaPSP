package consumidor;

package impresion.consumidor;

import org.apache.kafka.clients.consumer.*;
import java.time.Duration;
import java.util.*;

public class Impresoras {
    public static void main(String[] args) {
        // 3 Impresoras B/N
        for (int i = 1; i <= 3; i++) new Thread(new TareaImpresora("BN", i)).start();
        // 2 Impresoras Color
        for (int i = 1; i <= 2; i++) new Thread(new TareaImpresora("Color", i)).start();
    }

    static class TareaImpresora implements Runnable {
        String tipo;
        int id;

        public TareaImpresora(String t, int i) { tipo = t; id = i; }

        public void run() {
            Properties props = new Properties();
            props.put("bootstrap.servers", "localhost:9092");
            props.put("group.id", "grupo-impresoras-" + tipo);
            props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
            props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");

            KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);
            String topic = tipo.equals("Color") ? "cola-impresion-color" : "cola-impresion-bn";
            consumer.subscribe(Collections.singletonList(topic));

            System.out.println("üñ®Ô∏è Impresora " + tipo + "-" + id + " lista.");

            while (true) {
                for (ConsumerRecord<String, String> r : consumer.poll(Duration.ofMillis(500))) {
                    System.out.println("üñ®Ô∏è [" + tipo + "-" + id + "] Imprimiendo: " + r.value());
                    try { Thread.sleep(1500); } catch (Exception e) {}
                }
            }
        }
    }
}
